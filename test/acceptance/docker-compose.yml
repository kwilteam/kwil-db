version: "3"

services:
  kwild:
    container_name: kwild
    image: kwild:latest
    ports:
      - "8080:8080"
      - "50051:50051"
      - "26656:26656"
      - "26657:26657"
      - "40000:40000" # debugger
    env_file:
      - .env # docker compose by default will use this file, here just make it explicit
    volumes:
      - type: bind
        source: ${KWIL_HOME:-./.testnode}
        target: /app/kwil
    depends_on:
      - ext
    networks:
      - kwil-act-testnet
    command: |
      --root_dir=/app/kwil
      --log.level=${LOG_LEVEL:-info}
      --app.extension_endpoints=ext:50051
      --app.grpc_listen_addr=:50051
      --app.http_listen_addr=:8080
      --chain.p2p.external_address=tcp://0.0.0.0:26656
      --chain.rpc.laddr=tcp://0.0.0.0:26657

  ext:
    container_name: math_ext
    image: kwilbrennan/extensions-math:multi-arch
    ports:
      - "50151:50051"
    networks:
      - kwil-act-testnet


networks:
  kwil-act-testnet:
    name: kwil-act-testnet
    driver: bridge
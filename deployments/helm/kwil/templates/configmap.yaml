apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kwil.fullname" . }}
  labels:
    {{- include "kwil.labels" . | nindent 4 }}
data:
  {{- $grpcHost := include "kwild.fullname" .Subcharts.kwild }}
  {{ $graphqlHost := printf "%s-hasura" .Release.Name -}}
  KWILGW_GRAPHQL_ADDR: {{ printf "http://%s:%d" $graphqlHost (int .Values.kwild.hasura.service.ports.hasura) | quote }}
  KWILGW_KWILD_ADDR: {{ printf "%s:%d" $grpcHost (int .Values.kwild.service.ports.kwild) | quote }}
  KWILGW_LOG_LEVEL: {{ .Values.kwilApp.log.level | quote }}
  KWILGW_LOG_OUTPUT_PATHS: {{ .Values.kwilApp.log.outputPaths | join "," | quote }}
  KWILGW_SERVER_LISTEN_ADDR: {{ .Values.kwilApp.server.listenAddr | quote }}
  KWILGW_SERVER_CORS: {{ .Values.kwilApp.server.cors | quote }}
  KWILGW_SERVER_HEALTHCHECK_KEY: {{ .Values.kwilApp.server.healthcheckKey | sha256sum }}
  KWILGW_SERVER_KEY_FILE: {{ .Values.kwilApp.server.keyFile | quote }}
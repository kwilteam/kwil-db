{
  "owner": "BIEr70T257KhnAsBwtyl5Uuhk1oYkP/cuTq9DFNLIJwh5PYXaCP+9JP3ta+qRW8x1SkzY9j4AcVA68wGGBKJDLo=",
  "name": "testdb",
  "tables": [
    {
      "name": "posts",
      "columns": [
        {
          "name": "id",
          "type": "INT",
          "attributes": [
            {
              "type": "PRIMARY_KEY"
            },
            {
              "type": "NOT_NULL"
            }
          ]
        },
        {
          "name": "user_id",
          "type": "INT"
        },
        {
          "name": "title",
          "type": "TEXT"
        },
        {
          "name": "content",
          "type": "TEXT",
          "attributes": [
            {
              "type": "MAX_LENGTH",
              "value": "1000"
            }
          ]
        }
      ],
      "indexes": [
        {
          "name": "unique_index",
          "columns": [
            "user_id",
            "title"
          ],
          "type": "UNIQUE_BTREE"
        }
      ]
    },
    {
      "name": "users",
      "columns": [
        {
          "name": "id",
          "type": "INT",
          "attributes": [
            {
              "type": "PRIMARY_KEY"
            },
            {
              "type": "NOT_NULL"
            }
          ]
        },
        {
          "name": "username",
          "type": "TEXT",
          "attributes": [
            {
              "type": "DEFAULT",
              "value": "sds"
            }
          ]
        },
        {
          "name": "age",
          "type": "INT",
          "attributes": [
            {
              "type": "MIN",
              "value": "0"
            }
          ]
        },
        {
          "name": "wallet",
          "type": "BLOB",
          "attributes": [
            {
              "type": "UNIQUE"
            }
          ]
        }
      ]
    }
  ],
  "actions": [
    {
      "name": "get_post_authenticated",
      "inputs": [
        "$id"
      ],
      "mutability": "view",
      "public": true,
      "statements": [
        "SELECT *\n    FROM posts\n    WHERE id = $id;"
      ]
    },
    {
      "name": "get_user_posts",
      "inputs": [
        "$username"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "SELECT title, content\n    FROM posts\n    WHERE user_id = (\n        SELECT id\n        FROM users\n        WHERE username = $username\n    );"
      ]
    },
    {
      "name": "update_user",
      "inputs": [
        "$id",
        "$username",
        "$age"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "UPDATE [users]\n    SET id = $id, username = $username, age = $age\n    WHERE wallet = @caller;"
      ]
    },
    {
      "name": "divide",
      "inputs": [
        "$numerator1",
        "$numerator2",
        "$denominator"
      ],
      "mutability": "view",
      "public": true,
      "statements": [
        "$up=math_up.div(abs($numerator1+$numerator2),$denominator);",
        "$down=math_down.div(abs($numerator1+$numerator2),$denominator);",
        "select $up AS upper_value, $down AS lower_value;"
      ]
    },
    {
      "name": "get_post_unauthenticated",
      "inputs": [
        "$id"
      ],
      "mutability": "view",
      "public": true,
      "statements": [
        "SELECT *\n    FROM \"posts\"\n    WHERE id = $id;"
      ]
    },
    {
      "name": "get_user_by_wallet",
      "inputs": [
        "$address"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "SELECT *\n    FROM users\n    WHERE wallet = $address;"
      ]
    },
    {
      "name": "get_user_posts_by_userid",
      "inputs": [
        "$id"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "SELECT title, content\n    FROM posts\n    WHERE user_id = $id;"
      ]
    },
    {
      "name": "list_users",
      "mutability": "update",
      "public": true,
      "statements": [
        "SELECT *\n    FROM users;"
      ]
    },
    {
      "name": "owner_only",
      "mutability": "view",
      "public": true,
      "statements": [
        "select 'owner only';"
      ]
    },
    {
      "name": "create_post",
      "inputs": [
        "$id",
        "$title",
        "$content"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "INSERT INTO posts (id, user_id, title, content)\n    VALUES ($id, (\n        SELECT id FROM users WHERE wallet = @caller\n    ), $title, $content);"
      ]
    },
    {
      "name": "create_user",
      "inputs": [
        "$id",
        "$username",
        "$age"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "INSERT INTO \"users\" (id, username, age, wallet)\n    VALUES ($id, $username, $age, @caller);"
      ]
    },
    {
      "name": "delete_post",
      "inputs": [
        "$id"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "DELETE FROM posts\n    WHERE id = $id AND user_id = (\n        SELECT id\n        FROM users\n        WHERE wallet = @caller\n    );"
      ]
    },
    {
      "name": "update_username",
      "inputs": [
        "$username"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "UPDATE `users`\n    SET username = $username\n    WHERE wallet = @caller;"
      ]
    },
    {
      "name": "delete_user",
      "mutability": "update",
      "public": true,
      "statements": [
        "DELETE FROM users\n    WHERE public_key(wallet) = public_key(@caller);"
      ]
    },
    {
      "name": "delete_user_by_id",
      "inputs": [
        "$id"
      ],
      "mutability": "update",
      "public": true,
      "statements": [
        "DELETE FROM \"users\"\n    WHERE id = $id AND public_key(wallet) = public_key(@caller);"
      ]
    },
    {
      "name": "multi_select",
      "mutability": "update",
      "public": true,
      "statements": [
        "SELECT * FROM posts;",
        "SELECT * FROM users;"
      ]
    }
  ],
  "extensions": null
}
{
  "schema": {
    "owner": "BIEr70T257KhnAsBwtyl5Uuhk1oYkP/cuTq9DFNLIJwh5PYXaCP+9JP3ta+qRW8x1SkzY9j4AcVA68wGGBKJDLo=",
    "name": "testdb",
    "tables": [
      {
        "name": "posts",
        "columns": [
          {
            "name": "id",
            "type": "INT",
            "attributes": [
              {
                "type": "PRIMARY_KEY",
                "value": ""
              },
              {
                "type": "NOT_NULL",
                "value": ""
              }
            ]
          },
          {
            "name": "user_id",
            "type": "INT",
            "attributes": []
          },
          {
            "name": "title",
            "type": "TEXT",
            "attributes": []
          },
          {
            "name": "content",
            "type": "TEXT",
            "attributes": [
              {
                "type": "MAX_LENGTH",
                "value": "1000"
              }
            ]
          }
        ],
        "indexes": [
          {
            "name": "unique_index",
            "columns": [
              "user_id",
              "title"
            ],
            "type": "UNIQUE_BTREE"
          }
        ]
      },
      {
        "name": "users",
        "columns": [
          {
            "name": "id",
            "type": "INT",
            "attributes": [
              {
                "type": "PRIMARY_KEY",
                "value": ""
              },
              {
                "type": "NOT_NULL",
                "value": ""
              }
            ]
          },
          {
            "name": "username",
            "type": "TEXT",
            "attributes": [
              {
                "type": "DEFAULT",
                "value": "sds"
              }
            ]
          },
          {
            "name": "age",
            "type": "INT",
            "attributes": [
              {
                "type": "MIN",
                "value": "0"
              }
            ]
          },
          {
            "name": "wallet",
            "type": "BLOB",
            "attributes": [
              {
                "type": "UNIQUE",
                "value": ""
              }
            ]
          }
        ],
        "indexes": []
      }
    ],
    "actions": [
      {
        "name": "get_post_authenticated",
        "public": true,
        "inputs": [
          "$id"
        ],
        "statements": [
          "SELECT *\n    FROM posts\n    WHERE id = $id;"
        ],
        "mutability": "view",
        "auxiliaries": [
          "mustsign"
        ]
      },
      {
        "name": "get_user_posts",
        "public": true,
        "inputs": [
          "$username"
        ],
        "statements": [
          "SELECT title, content\n    FROM posts\n    WHERE user_id = (\n        SELECT id\n        FROM users\n        WHERE username = $username\n    );"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "update_user",
        "public": true,
        "inputs": [
          "$id",
          "$username",
          "$age"
        ],
        "statements": [
          "UPDATE [users]\n    SET id = $id, username = $username, age = $age\n    WHERE wallet = @caller;"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "divide",
        "public": true,
        "inputs": [
          "$numerator1",
          "$numerator2",
          "$denominator"
        ],
        "statements": [
          "$up=math_up.div(abs($numerator1+$numerator2),$denominator);",
          "$down=math_down.div(abs($numerator1+$numerator2),$denominator);",
          "select $up AS upper_value, $down AS lower_value;"
        ],
        "mutability": "view",
        "auxiliaries": []
      },
      {
        "name": "get_post_unauthenticated",
        "public": true,
        "inputs": [
          "$id"
        ],
        "statements": [
          "SELECT *\n    FROM \"posts\"\n    WHERE id = $id;"
        ],
        "mutability": "view",
        "auxiliaries": []
      },
      {
        "name": "get_user_by_wallet",
        "public": true,
        "inputs": [
          "$address"
        ],
        "statements": [
          "SELECT *\n    FROM users\n    WHERE wallet = $address;"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "get_user_posts_by_userid",
        "public": true,
        "inputs": [
          "$id"
        ],
        "statements": [
          "SELECT title, content\n    FROM posts\n    WHERE user_id = $id;"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "list_users",
        "public": true,
        "inputs": [],
        "statements": [
          "SELECT *\n    FROM users;"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "owner_only",
        "public": true,
        "inputs": [],
        "statements": [
          "select 'owner only';"
        ],
        "mutability": "view",
        "auxiliaries": [
          "owner",
          "mustsign"
        ]
      },
      {
        "name": "create_post",
        "public": true,
        "inputs": [
          "$id",
          "$title",
          "$content"
        ],
        "statements": [
          "INSERT INTO posts (id, user_id, title, content)\n    VALUES ($id, (\n        SELECT id FROM users WHERE wallet = @caller\n    ), $title, $content);"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "create_user",
        "public": true,
        "inputs": [
          "$id",
          "$username",
          "$age"
        ],
        "statements": [
          "INSERT INTO \"users\" (id, username, age, wallet)\n    VALUES ($id, $username, $age, @caller);"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "delete_post",
        "public": true,
        "inputs": [
          "$id"
        ],
        "statements": [
          "DELETE FROM posts\n    WHERE id = $id AND user_id = (\n        SELECT id\n        FROM users\n        WHERE wallet = @caller\n    );"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "update_username",
        "public": true,
        "inputs": [
          "$username"
        ],
        "statements": [
          "UPDATE `users`\n    SET username = $username\n    WHERE wallet = @caller;"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "delete_user",
        "public": true,
        "inputs": [],
        "statements": [
          "DELETE FROM users\n    WHERE public_key(wallet) = public_key(@caller);"
        ],
        "mutability": "update",
        "auxiliaries": []
      },
      {
        "name": "delete_user_by_id",
        "public": true,
        "inputs": [
          "$id"
        ],
        "statements": [
          "DELETE FROM \"users\"\n    WHERE id = $id AND public_key(wallet) = public_key(@caller);"
        ],
        "mutability": "update",
        "auxiliaries": [
          "owner"
        ]
      },
      {
        "name": "multi_select",
        "public": true,
        "inputs": [],
        "statements": [
          "SELECT * FROM posts;",
          "SELECT * FROM users;"
        ],
        "mutability": "update",
        "auxiliaries": []
      }
    ],
    "extensions": []
  }
}
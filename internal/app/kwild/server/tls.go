package server

import (
	"os"
	"time"

	"github.com/decred/dcrd/certgen"
)

// genCertPair generates a key/cert pair to the paths provided.
func genCertPair(certFile, keyFile string, altDNSNames []string) error {
	org := "kwild gRPC server autogenerated cert"
	validUntil := time.Now().Add(10 * 365 * 24 * time.Hour)
	cert, key, err := certgen.NewEd25519TLSCertPair(org,
		validUntil, altDNSNames)
	if err != nil {
		return err
	}

	if err = os.WriteFile(certFile, cert, 0644); err != nil {
		return err
	}
	if err = os.WriteFile(keyFile, key, 0600); err != nil {
		os.Remove(certFile)
		return err
	}

	return nil
}
